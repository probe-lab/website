frequency: daily
datasets:
  - name: "Bifrost total requests by day"
    source: "caracol"
    query: >
      with q as (
        select id, start, case
          when interval='hourly' then '1 hour'::interval
          when interval='daily'  then '1 day'::interval
          when interval='weekly' then '1 week'::interval
        end as step
        from queries
      )
      select c.seq, q.start+c.seq*q.step as date, c.value as value
      from q left join collections c on c.query_id = q.id
      where c.query_id=4
        and q.start+c.seq*q.step >= {{ .StartOfWeek | timestamptz }} - '8 week'::interval
        and q.start+c.seq*q.step < {{ .StartOfWeek | timestamptz }};


series:
  - type: "bar"
    name: "Total"
    dataset: "Bifrost total requests by day"
    labels: "date"
    values: "value"


layout:
  title:
    text: "HTTP Originated Requests (30 days up to 12 Apr 2023)"
  legend:
    orientation: "h"
  yaxis:
    autorange: true
    rangemode: "tozero"
    title:
      text: "Number of requests"
